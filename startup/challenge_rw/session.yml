name: icuas_ch
root: ./
startup_window: roscore
pre_window: |
  export ARENA_TYPE=<%= @settings["arena"]%>;
  source challenge_setup_rw.sh
windows:
  - roscore:
      layout:
      panes:
        - roscore
        - waitForRos; roslaunch uav_ros_general apm2.launch fcu_url:=$PIX_SYM
        - waitForRos; waitForMavros; sleep 10; rosrun mavros mavsys -n $UAV_NAMESPACE/mavros rate --all 50
        - waitForRos; roslaunch uav_ros_general optitrack.launch object_name:=$OBJECT_NAME ip:=$OPTITRACK_IP    
        - waitForRos; roslaunch uav_ros_general optitrack.launch object_name:=ground_plane ip:=$OPTITRACK_IP    
        - waitForRos; roslaunch uav_ros_general rc_to_joy.launch
        - waitForRos; roslaunch realsense2_camera rs_rgbd.launch
          camera:=$CAMERA_LINK
        - waitForRos; roslaunch icuas23_competition camera_transform_publisher.launch
          base_link:=$OBJECT_NAME
          camera_link:=${CAMERA_LINK}_link
  - arm&takeof:
      layout: tiled
      panes:
        - waitForRos; roslaunch uav_ros_control pid_carrot.launch 
          msf_callback_enable:=true
          odometry:=$ODOM_TOPIC
          control_type:=pid_cascade_node_yawrate
          default_params:=$(rospack find uav_ros_control)/config/control/optitrack_position_control_falcon_thrust.params.yaml
          carrot_config:=$(rospack find icuas23_competition)/config/carrot_config.yaml
          hold_trajectory:=position_hold/final_trajectory
          carrot_frame_id:=$MAP_FRAME
          carrot_land:=true
          geofence_enabled:=true
          geofence_config:=$GEOFENCE_CONFIG
        - history -s "waitForRos; roslaunch uav_ros_control uav_manager.launch odometry:=$ODOM_TOPIC"
  - trajectory:
      layout: tiled
      panes:
        - waitForRos; roslaunch uav_ros_tracker topp_tracker.launch 
          tracker_config:=custom_config/topp_config_custom.yaml
          input_trajectory:=tracker/final_input_trajectory
          input_pose:=tracker/final_input_pose
        - waitForRos; roslaunch uav_ros_indoor safety_node.launch
          config:=$(rospack find uav_ros_indoor)/config/safety_config.yaml
  - safety:
      layout: tiled
      panes:
        - waitForRos; roslaunch icuas23_competition global_planner.launch
        - waitForRos; roslaunch icuas23_competition octomap_server.launch
          map_frame_id:=$MAP_FRAME
          base_link_frame_id:=$BASE_LINK
          map_file:=$OCTOMAP_FILE
        - waitForRos; rosrun icuas_support wp_spawner.py $(rospack find icuas_support)/resources/waypoints_warszava_1.csv __ns:=$UAV_NAMESPACE

  - bag:
      layout: tiled
      panes:
        - history -s "rosbag record /red/camera/color/camera_info /red/camera/color/image_raw/compressed /red/camera/depth/camera_info /red/camera/depth/image_rect_raw /red/mavros/imu/data /falconblack/vrpn_client/estimated_odometry -o /root/bags/icuas23_test"
  - transforms:
      layout: tiled
      panes:
        - waitForRos; rosrun tf static_transform_publisher 0 0 0 0 0 0 world optitrack 10
        - waitForRos; rosrun tf static_transform_publisher 0 0 0 0 0 0 red/camera_color_optical_frame red/camera 10
        - waitForRos; rosrun larics_motion_planning visualize_joint_trajectory_as_marker_array.py
          __ns:=$UAV_NAMESPACE 
          joint_trajectory:=debug/collision_trajectory 
          visualization/multiple_trajectories:=debug/collision_marker 


